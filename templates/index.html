<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marks-Entry-App</title>
    <link rel="stylesheet" href="../static/Admin.css">
    <link rel="stylesheet" href="./student/login.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

    <style>
        .toast {
            font-weight: bold;
            color: #fff;
            opacity: 1;
            border-radius: 5px;

        }
    </style>

</head>

<body>
    <div class="">
        <nav class="navbar fixed-top navbar-expand navbar-light d-float navbar-custom">
            <div class="d-flex justify-content-between d-block">
                <button class="btn px-1 py-0 open-btn me-2"><img src="../static/Pictures/menu (1).png" alt="Nav"
                        style="width: 30px;"></button>
            </div>
                    <a id="name" class="navbar-brand" href="#"><img class="logo" src="../../static/Pictures/logo.png"
                        alt="logo">Marks-Entry-App</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end"
                style="margin-right: 10px; width: 0px; height: 0px;" id="navbarNav">
                <button type="button" id="loginBtn" class="btn btn-danger d-table float-right"
                    style="align-self: flex-end;display: none; visibility: hidden;">Log Out</button>
            </div>
        </nav>
    </div>
    <div class="content d-flex" style="display: flex;">
        <div class="sidebar" id="side_nav">
            <ul class="list-unstyled px-2">
                <li class="active"><a href="#" class="text-decoration-none px-3 py-2 d-block"><i
                            class="fal fa-home"></i> Home</a></li>
                <li><a href="#" class="text-decoration-none px-3 py-2 d-block" data-bs-toggle="modal"
                        data-bs-target="#loginModal"><i class="fal fa-list"></i> Student Login</a></li>

                <li><a href="#" class="text-decoration-none px-3 py-2 d-block d-flex justify-content-between"
                        data-bs-toggle="modal" data-bs-target="#registerModal"><span><i class="fal fa-comment"></i>
                            Student Registration</span></a></li>
                <li><a href="#" class="text-decoration-none px-3 py-2 d-block" data-bs-toggle="modal"
                        data-bs-target="#staffLoginModal"><i class="fal fa-envelope-open-text"></i> Staff Login</a></li>
                <li><a href="#" class="text-decoration-none px-3 py-2 d-block" data-bs-toggle="modal"
                        data-bs-target="#staffRegisterModal"><i class="fal fa-envelope-open-text"></i>
                        Staff Registration</a></li>
            </ul>
            <hr class="h-color mx-2" style="color: aliceblue;">

            <!-- <ul class="list-unstyled px-2">
                <li><a href="#" class="text-decoration-none px-3 py-2 d-block"><i class="fal fa-bars"></i> Settings</a>
                </li>
            </ul> -->

        </div>

        <div class="dashboard-content Main_window px-3 pt-4">
            <h2 class="fs-5">Dashboard</h2>
            <!-- Student Login Modal -->
            <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="loginModalTitle">Student Login</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="outcontainer bg-white">
                                <h1 class="text-primary text-center">Sunbeam</h1>
                                <div class="container mt-5">
                                    <form id="loginForm">
                                        <div class="form-group">
                                            <label for="loginEmail" class="pb-1">Email</label>
                                            <input type="email" class="form-control" id="loginEmail" placeholder="Email"
                                                name="email" required />
                                            <div id="evalid" style="color: red;"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="loginPassword" class="pb-1">Password</label>
                                            <input type="password" class="form-control" id="loginPassword"
                                                placeholder="Password" name="password" required />
                                            <div id="passvalid" style="color: red;"></div>
                                        </div>
                                        <div class="d-flex flex-column">
                                            <a href="#S">Forgot Password</a>
                                            <button id="login" class="btn btn-success"
                                                style="align-self: center;">Login</button>
                                        </div>
                                    </form>
                                    <p class="mt-3" style="align-self: center;">Not registered? <a href="#">Create an
                                            account</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Student Register Modal -->
            <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalTitle"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="registerModalTitle">Student Register</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="outcontainer bg-white">
                                <h1 class="text-primary text-center">Sunbeam</h1>
                                <div class="container mt-5 d-flex flex-column">
                                    <form id="regForm" class="d-flex flex-column">
                                        <div class="form-group">
                                            <label for="regName" class="pb-1">Full name</label>
                                            <input type="text" class="form-control" id="regName" placeholder="Name"
                                                required />
                                        </div>
                                        <div class="form-group">
                                            <label for="regRollNo" class="pb-1">Roll Number</label>
                                            <input type="number" class="form-control" id="regRollNo"
                                                placeholder="Roll number" required />
                                        </div>
                                        <div class="form-group">
                                            <label for="regEmail" class="pb-1">Email</label>
                                            <input type="email" class="form-control" id="regEmail" placeholder="Email"
                                                required />
                                        </div>
                                        <div class="form-group">
                                            <label for="regPassword" class="pb-1">Create Password</label>
                                            <input type="password" class="form-control" id="regPassword"
                                                placeholder="Password" required />
                                        </div>
                                        <div class="d-flex justify-content-end">
                                            <button id="submit" class="btn btn-success">Submit</button>
                                        </div>
                                    </form>
                                    <p class="mt-3" style="align-self: center;">Already registered? <a
                                            href="#">Login</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Staff Login Modal -->
            <div class="modal fade" id="staffLoginModal" tabindex="-1" aria-labelledby="staffLoginModalTitle"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="staffLoginModalTitle">Staff Login</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="outcontainer bg-white">
                                <h1 class="text-primary text-center">Sunbeam</h1>
                                <div class="container mt-5">
                                    <form id="staffLoginForm">
                                        <div class="form-group">
                                            <label for="staffLoginEmail" class="pb-1">Email</label>
                                            <input type="text" class="form-control" id="staffLoginEmail"
                                                placeholder="Email" name="email" required />
                                            <div id="staffEvalid" style="color: red;"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="staffLoginPassword" class="pb-1">Password</label>
                                            <input type="password" class="form-control" id="staffLoginPassword"
                                                placeholder="Password" name="password" required />
                                            <div id="staffPassvalid" style="color: red;"></div>
                                        </div>
                                        <div class="d-flex flex-column">
                                            <a href="#S">Forgot Password</a>
                                            <button id="staffLogin" class="btn btn-success"
                                                style="align-self: center;">Login</button>
                                        </div>
                                    </form>
                                    <p class="mt-3" style="align-self: center;">Not registered? <a href="#">Create an
                                            account</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Staff Register Modal -->
            <div class="modal fade" id="staffRegisterModal" tabindex="-1" aria-labelledby="staffRegisterModalTitle"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="staffRegisterModalTitle">Staff Register</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="outcontainer bg-white">
                                <h1 class="text-primary text-center">Sunbeam</h1>
                                <div class="container mt-5 d-flex flex-column">
                                    <form id="staffRegForm" class="d-flex flex-column">
                                        <div class="form-group">
                                            <label for="staffRegName" class="pb-1">Full name</label>
                                            <input type="text" class="form-control" id="staffRegName" placeholder="Name"
                                                required />
                                        </div>
                                        <div class="form-group">
                                            <label for="staffEmployeeNumber" class="pb-1">Employee Number</label>
                                            <input type="number" class="form-control" id="staffEmployeeNumber"
                                                placeholder="Employee Number" required />
                                        </div>
                                        <div class="form-group">
                                            <label for="staffRegEmail" class="pb-1">Email</label>
                                            <input type="email" class="form-control" id="staffRegEmail"
                                                placeholder="Email" required />
                                        </div>
                                        <div class="form-group">
                                            <label for="staffRegPassword" class="pb-1">Create Password</label>
                                            <input type="password" class="form-control" id="staffRegPassword"
                                                placeholder="Password" required />
                                        </div>
                                        <div class="d-flex justify-content-end">
                                            <button id="staffSubmit" class="btn btn-success">Register</button>
                                        </div>
                                    </form>
                                    <!-- <p class="mt-3" style="align-self: center;">Already registered? <a
                                            href="#">Login</a></p> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <script src="../static/Admin.js"></script>
    <script src="./student/student_login.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Toastr configuration
            toastr.options = {
                positionClass: 'toast-top-center',
                timeOut: 5000,
                preventDuplicates: true,
                closeButton: true,
                progressBar: true,
                showEasing: 'swing'
            };

            // Common validation functions
            function validateEmail(email) {
                if (email.trim() === '') {
                    toastr.error('Email cannot be empty');
                    return false;
                }
                let regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                if (!regex.test(email.trim())) {
                    toastr.error('Please enter a valid email');
                    return false;
                }
                return true;
            }

            function validatePassword(password) {
                if (password.trim() === '') {
                    toastr.error('Password cannot be empty');
                    return false;
                }
                if (password.trim().length < 8) {
                    toastr.error('Password must be at least 8 characters long');
                    return false;
                }
                return true;
            }

            function validateNotEmpty(value, message) {
                if (value.trim() === '') {
                    toastr.error(message + ' cannot be empty');
                    return false;
                }
                return true;
            }

            // Student Login
            document.getElementById("login").addEventListener("click", async function (e) {
                e.preventDefault();
                let email = document.getElementById("loginEmail").value.trim();
                let password = document.getElementById("loginPassword").value.trim();

                if (validateEmail(email) && validatePassword(password)) {
                    const response = await fetch("http://127.0.0.1:5000/user/student/login", {
                        method: "POST",
                        body: JSON.stringify({ "email": email, "password": password }),
                        headers: { "Content-type": "application/json; charset=UTF-8" }
                    });

                    const data = await response.json();
                    if (data.status === "success") {
                        localStorage.setItem("token", JSON.stringify(data.data.token));
                        window.location.href = "./student/student_home.html";
                    } else {
                        toastr.error('Oops! Something went wrong.');
                    }
                }
            });

            // Student Registration
            document.getElementById("submit").addEventListener("click", async function (e) {
                e.preventDefault();
                let name = document.getElementById("regName").value.trim();
                let email = document.getElementById("regEmail").value.trim();
                let password = document.getElementById("regPassword").value.trim();
                let roll = document.getElementById("regRollNo").value.trim();

                if (validateNotEmpty(name, 'Name') && validateEmail(email) && validatePassword(password) && validateNotEmpty(roll, 'Roll Number')) {
                    const response = await fetch("http://127.0.0.1:5000/user/student/register", {
                        method: "POST",
                        body: JSON.stringify({ "name": name, "email": email, "roll": roll, "password": password }),
                        headers: { "Content-type": "application/json; charset=UTF-8" }
                    });

                    const data = await response.json();
                    if (data.status == "success") {
                        $('#registerModal').modal('hide');
                        toastr.success('Student registered successfully');
                    } else {
                        toastr.error('Oops! Something went wrong.');
                    }
                }
            });

            // Staff Login
            document.getElementById("staffLogin").addEventListener("click", async function (e) {
                e.preventDefault();
                let email = document.getElementById("staffLoginEmail").value.trim();
                let password = document.getElementById("staffLoginPassword").value.trim();

                if (validateEmail(email) && validatePassword(password)) {
                    const response = await fetch("http://127.0.0.1:5000/staff/login", {
                        method: "POST",
                        body: JSON.stringify({ "email": email, "password": password }),
                        headers: { "Content-type": "application/json; charset=UTF-8" }
                    });

                    const data = await response.json();
                    if (data.status === "success") {
                        const decodedToken = jwt_decode(data.data.token);
                        localStorage.setItem("token", JSON.stringify(data.data.token));

                        switch (decodedToken.role) {
                            case 'admin':
                                window.location.href = "./admin/admin.html";
                                break;
                            case 'coordinator':
                                window.location.href = "./Coco/Coordinator.html";
                                break;
                            case 'staff':
                                window.location.href = "./staff/staffhome.html";
                                break;
                            default:
                                toastr.error('Role not recognized');
                        }
                    } else {
                        toastr.error('Oops! Something went wrong.');
                    }
                }
            });

            // Staff Registration
            document.getElementById("staffSubmit").addEventListener("click", async function (e) {
                e.preventDefault();
                let name = document.getElementById("staffRegName").value.trim();
                let email = document.getElementById("staffRegEmail").value.trim();
                let password = document.getElementById("staffRegPassword").value.trim();
                let employeeNumber = document.getElementById("staffEmployeeNumber").value.trim();

                if (validateNotEmpty(name, 'Name') && validateEmail(email) && validatePassword(password) && validateNotEmpty(employeeNumber, 'Employee Number')) {
                    const response = await fetch("http://127.0.0.1:5000/staff/register", {
                        method: "POST",
                        body: JSON.stringify({ "staffname": name, "staffemail": email, "password": password, "employee_number": employeeNumber, "role": "staff" }),
                        headers: { "Content-type": "application/json; charset=UTF-8" }
                    });

                    const data = await response.json();
                    if (data.status == "success") {
                        $('#staffRegisterModal').modal('hide');
                        toastr.success('Staff registered successfully');
                    } else {
                        toastr.error('Oops! Something went wrong.');
                    }
                }
            });
        });
    </script>

</body>

</html>